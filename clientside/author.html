<!DOCTYPE html>

<!--
 // WEBSITE: https://themefisher.com
 // TWITTER: https://twitter.com/themefisher
 // FACEBOOK: https://www.facebook.com/themefisher
 // GITHUB: https://github.com/themefisher/
-->

<html lang="en-us">

<head>
   <meta charset="utf-8">
   <title>John Doe</title>

   <!-- mobile responsive meta -->
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
   <meta name="description" content="This is meta description">
   <meta name="author" content="Themefisher">

   <!-- plugins -->
   <link rel="preload" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFWJ0bbck.woff2" style="font-display: optional;">
   <link rel="stylesheet" href="plugins/bootstrap/bootstrap.min.css">
   <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:600%7cOpen&#43;Sans&amp;display=swap" media="screen">

   <link rel="stylesheet" href="plugins/themify-icons/themify-icons.css">
   <link rel="stylesheet" href="plugins/slick/slick.css">

   <!-- Main Stylesheet -->
   <link rel="stylesheet" href="css/style.css">

   <!--Favicon-->
   <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">
   <link rel="icon" href="images/favicon.png" type="image/x-icon">
</head>

<body>
<!-- navigation -->
<header class="sticky-top bg-white border-bottom border-default">
   <div class="container">

      <nav class="navbar navbar-expand-lg navbar-white">
         <a class="navbar-brand" href="index.html">
            <img class="img-fluid" width="150px" src="images/logo.png" alt="LogBook">
         </a>
         <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
            <i class="ti-menu"></i>
         </button>

         <div class="collapse navbar-collapse text-center" id="navigation">
            <ul class="navbar-nav ml-auto">
 
                  <a class="nav-link" href="index.html" role="button"  
                     aria-expanded="false">
                     New Posts  
                  </a>
 
               <li class="nav-item">
                  <a class="nav-link" href="about.html">About</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="contact.html">Contact</a>
               </li>
               <li class="nav-item dropdown">
                  <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                     aria-expanded="false"> Logout <i class="ti-angle-down ml-1"></i>
                  </a>
                  <div class="dropdown-menu">
                     <a class="dropdown-item" href="sign-in.html">Switch into another Account</a>
                     <a class="dropdown-item" href="sign-up.html">Logout</a>
                     <a class="dropdown-item" href="privacy-policy.html">Privacy Policy</a>
                     <a class="dropdown-item" href="terms-conditions.html">Terms Conditions</a>
                  </div>
               </li>
            </ul>
            
            <select class="m-2 border-0" id="select-language">
               <option id="en" value="about/" selected>En</option>
            </select>

            <!-- search -->
            <div class="search px-4">
               <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
               <div class="search-wrapper">
                  <form action="javascript:void(0)" class="h-100">
                     <input class="search-box pl-4" id="search-query" name="s" type="search" placeholder="Type &amp; Hit Enter...">
                  </form>
                  <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
               </div>
            </div>

         </div>
      </nav>
   </div>
</header>
<!-- /navigation -->

<section class="section-sm ">
	<div class="container"">
		<div class="row">
			<div class="col-12">
				<div class="title-bordered mb-5 d-flex align-items-center">
					<h1 class="h4"> </h1>
					<ul class="list-inline social-icons ml-auto mr-3 d-none d-sm-block">
						<li class="list-inline-item"><a href="#"><i class="ti-facebook"></i></a>
						</li>
						<li class="list-inline-item"><a href="#"><i class="ti-twitter-alt"></i></a>
						</li>
						<li class="list-inline-item"><a href="#"><i class="ti-github"></i></a>
						</li>
					</ul>
				</div>
			</div>
			<div class="col-lg-3 col-md-4 mb-4 mb-md-0 text-center text-md-left">
				<img loading="lazy" class="img-fluid grayscale" src="images/profile-pic.jpg">
			</div>
			<div class="col-lg-9 col-md-8 content text-center text-md-left">
				<p style="color: black;"><strong>Passionate gamer enthusiast with boundless energy and a passion for leveling up, conquering challenges, and having fun. Always ready for the next adventure!</strong></p>
				<p style="color: black;">Whether it's battling bosses, exploring open worlds, or teaming up with friends, I am always in the zone. A quick thinker with sharp reflexes, I am not just about winning but mastering every game I plays. Outside the virtual world, my creativity and enthusiasm make me the go-to guy for new ideas and epic adventures.</p>
			</div>
		</div>
	</div>
</section>

<div class="container">
   <div class="col-lg-12">
     <div class="title text-center">
       <h2 class="mb-5">What's on your mind?</h2>
     </div>
   </div>
   <div class="card glass-card">
     <div class="card-body">
       <form id="postForm" style="width: 100%; align-items: center; margin:auto;">
         <div class="position-relative mb-3">
           <input type="text" id="title" class="form-control" placeholder="Post's Title..." required>
         </div>
         <div class="position-relative mb-3">
           <textarea id="description" class="form-control" placeholder="What are your thoughts!" rows="4" required></textarea>
         </div>
         <div class="position-relative mb-3">
           <label for="tagId">My Post is</label>
           <select id="tagId" class="form-control" required>
            <option value="" disabled selected>Tagged as</option>
            <option value="4">Games</option>          <!-- New tag under Fun -->
            <option value="5">Movies</option>         <!-- New tag under Fun -->
            <option value="6">Tutorials</option>      <!-- New tag under Educational -->
            <option value="7">Courses</option>        <!-- New tag under Educational -->
            <option value="8">AI</option>             <!-- New tag under Technology -->
            <option value="9">Programming</option>    <!-- New tag under Technology -->
            <option value="10">Others</option>    <!-- New tag under Technology -->

         </select>
         </div>
         <div class="position-relative mb-3">
           <select id="categoryId" class="form-control" required>
             <option value="" disabled selected>Categorized as</option>
             <option value="1">Fun</option>
             <option value="2">Educational</option>
             <option value="3">Technology</option>
           </select>
         </div>
         <button class="btn btn-primary btn-block rounded" type="submit" style="width: 100%; align-items: center;">
           Post Now
         </button>
       </form>
     </div>
   </div>
 </div>
 



<section class="section-sm">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="title text-center">
                    <h2 class="mb-5">Posted by this author</h2>
                </div>
            </div>
            <!-- This is where posts will be dynamically added -->
            <div id="posts-container" class="row poster-card"></div>
        </div>
    </div>
</section>
   <footer class="section-sm pb-0 border-top border-default">
      <div class="container">
         <div class="row justify-content-between">
            <div class="col-md-3 mb-4">
               <a class="mb-4 d-block" href="index.html">
                  <img class="img-fluid" width="150px" src="images/logo.png" alt="LogBook">
               </a>
               <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</p>
            </div>

            <div class="col-lg-2 col-md-3 col-6 mb-4">
               <h6 class="mb-4">Quick Links</h6>
               <ul class="list-unstyled footer-list">
                  <li><a href="about.html">About</a></li>
                  <li><a href="contact.html">Contact</a></li>
                  <li><a href="privacy-policy.html">Privacy Policy</a></li>
                  <li><a href="terms-conditions.html">Terms Conditions</a></li>
               </ul>
            </div>

            <div class="col-lg-2 col-md-3 col-6 mb-4">
               <h6 class="mb-4">Social Links</h6>
               <ul class="list-unstyled footer-list">
                  <li><a href="#">facebook</a></li>
                  <li><a href="#">twitter</a></li>
                  <li><a href="#">linkedin</a></li>
                  <li><a href="#">github</a></li>
               </ul>
            </div>

            <div class="col-md-3 mb-4">
               <h6 class="mb-4">Subscribe Newsletter</h6>
               <form class="subscription" action="javascript:void(0)" method="post">
                  <div class="position-relative">
                     <i class="ti-email email-icon"></i>
                     <input type="email" class="form-control" placeholder="Your Email Address">
                  </div>
                  <button class="btn btn-primary btn-block rounded" type="submit">Subscribe now</button>
               </form>
            </div>
         </div>
         <div class="scroll-top">
            <a href="javascript:void(0);" id="scrollTop"><i class="ti-angle-up"></i></a>
         </div>
         <div class="text-center">
            <p class="content">&copy; 2020 - Design &amp; Develop By <a href="https://themefisher.com/" target="_blank">Themefisher</a></p>
         </div>
      </div>
   </footer>


   <!-- JS Plugins -->
   <script src="plugins/jQuery/jquery.min.js"></script>
   <script src="plugins/bootstrap/bootstrap.min.js" async></script>
   <script src="plugins/slick/slick.min.js"></script>

   <!-- Main Script -->
   <script src="js/script.js"></script>
   <script>
	const userName = localStorage.getItem("userName");

	if (userName) {
	    document.querySelector("h1.h4").textContent = userName;
	    document.querySelector("title").textContent = userName;
	} else {
	    console.error("User name not found in local storage.");
	}

   </script>

<script>
   document.getElementById('postForm').addEventListener('submit', async function (event) {
     event.preventDefault(); // Prevent form from refreshing the page
    // Retrieve userId from localStorage and convert it to a number
    const userId = parseInt(localStorage.getItem("userId"));

    // Collect form data
    const data = {
      userId, // Now userId will be a number
       title: document.getElementById('title').value,
       description: document.getElementById('description').value,
       tagId: parseInt(document.getElementById('tagId').value),
       categoryId: parseInt(document.getElementById('categoryId').value),
     };
 console.log(data);
     try {
       // Send POST request to your API endpoint
       const response = await fetch('https://localhost:7069/api/Posts', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json',
         },
         body: JSON.stringify(data),
       });
 
       if (response.ok) {
         const result = await response.json();
         alert('Post created successfully!');
         console.log(result);
       } else {
         alert('Failed to create post.');
         console.error(await response.text());
       }
     } catch (error) {
       console.error('Error:', error);
       alert('An error occurred.');
     }
   });
 </script>


<script>
   const userId = localStorage.getItem("userId");
   console.log(userId);

   const POSTS_API_URL = `https://localhost:7069/api/Posts/user/${userId}`;
   const USER_API_URL = `https://localhost:7069/api/Users/${userId}`;
   const CATEGORIES_API_URL = `https://localhost:7069/api/Categories`; // Assuming this is the endpoint for categories

   let ExtracteduserName = "Unknown User"; // Default name
   let categoriesMap = {}; // Map of categoryId to categoryName

   // Fetch user details
   async function fetchUserDetails() {
       try {
           const response = await fetch(USER_API_URL);
           if (!response.ok) throw new Error(`Failed to fetch user details: ${response.statusText}`);
           
           const user = await response.json();
           ExtracteduserName = user.name || `User ${userId}`;
       } catch (error) {
           console.error("Error fetching user details:", error);
       }
   }

   // Fetch categories
   async function fetchCategories() {
       try {
           const response = await fetch(CATEGORIES_API_URL);
           if (!response.ok) throw new Error(`Failed to fetch categories: ${response.statusText}`);
           
           const categories = await response.json();
           // Create a mapping of categoryId to categoryName
           categories.forEach(category => {
               categoriesMap[category.id] = category.name;
           });
       } catch (error) {
           console.error("Error fetching categories:", error);
       }
   }

   // Fetch posts and render them
   async function fetchPosts() {
       try {
           await Promise.all([fetchUserDetails(), fetchCategories()]); // Fetch user and categories in parallel

           console.log("Categories Map:", categoriesMap); // Debugging line

           const response = await fetch(POSTS_API_URL);
           if (!response.ok) throw new Error(`Failed to fetch posts: ${response.statusText}`);
           
           const posts = await response.json();
           renderPosts(posts);
       } catch (error) {
           console.error("Error fetching posts:", error);
       }
   }

   // Render posts into the DOM
   function renderPosts(posts) {
       const postsContainer = document.getElementById("posts-container");

       if (!posts.length) {
           postsContainer.innerHTML = `<p>No posts available for this user.</p>`;
           return;
       }

       posts.forEach(post => {
           const categoryName = categoriesMap[post.categoryId] || `Category ${post.categoryId}`;
           const postHTML = `
               <div class="col-lg-12 col-sm-6 mb-4">
                   <article class="mb-5" style="width: 75%; align-items: center; margin:auto;">
                       <h3 class="h3"><a class="post-title" href="post-details.html?id=${post.id}">${post.title}</a></h3>
                       <ul class="list-inline post-meta mb-2">
                           <li class="list-inline-item"><i class="ti-user mr-2"></i>Author: ${userName}</li>
                           <li class="list-inline-item">Date: ${new Date(post.createdAt).toLocaleDateString()}</li>
                           <li class="list-inline-item">Category: <a href="#!" class="ml-1">${categoryName}</a></li>
                           <li class="list-inline-item">Upvotes: ${post.upvotes}</li>
                           <li class="list-inline-item">Downvotes: ${post.downvotes}</li>
                       </ul>
                       <p>${post.description}</p>
                        <button class="btn btn-outline-secondary" onclick="editPost(${post.id})">Edit</button>
                       <button class="btn btn-outline-danger" onclick="deletePost(${post.id})">Delete</button>
                   </article>
               </div>
           `;
           postsContainer.insertAdjacentHTML("beforeend", postHTML);
       });
   }

   // Load posts on page load
   window.addEventListener("DOMContentLoaded", fetchPosts);
</script>

<script>
   async function editPost(postId) {
       // Redirect to the edit page with the post ID
       window.location.href = `edit-post.html?id=${postId}`;
   }

   async function deletePost(postId) {
       if (confirm("Are you sure you want to delete this post?")) {
           try {
               const response = await fetch(`https://localhost:7069/api/Posts/${postId}`, {
                   method: 'DELETE',
               });
               if (response.ok) {
                   alert('Post deleted successfully!');
                   // Optionally, refresh the posts or remove the post from the DOM
                   fetchPosts(); // Refresh the posts
               } else {
                   alert('Failed to delete post.');
               }
           } catch (error) {
               console.error('Error:', error);
               alert('An error occurred while deleting the post.');
           }
       }
   }
</script>

</html>